jQuery(document).ready((function(){!function(){var e=document.querySelector("#happyfiles-settings-content");if(e){for(var t=document.querySelectorAll("#happyfiles-settings-tabs a"),a=e.querySelectorAll("table"),r=0;r<t.length;r++)t[r].addEventListener("click",(function(e){e.preventDefault();var a=e.target.getAttribute("data-tab-id");if(a){location.hash=a,window.scrollTo({top:0});for(var r=0;r<t.length;r++)t[r].classList.remove("nav-tab-active");e.target.classList.add("nav-tab-active"),l(a)}}));var i=location.hash.replace("#","");if(i){var s=document.querySelector('[data-tab-id="'+i+'"]');s&&s.click()}}function l(e){document.getElementById(e);for(var t=0;t<a.length;t++){var r=a[t];r.getAttribute("id")===e?r.classList.add("active"):r.classList.remove("active")}}}(),jQuery(document).on("click",".happyfiles-import",(function(e){e.preventDefault();var t=e.target.getAttribute("data-plugin");if(t){var a=-1!==["filebird","real-media-library"].indexOf(t)?"happyfiles_import_third_pary_tables":"happyfiles_import_third_party_terms";e.target.querySelector(".spinner").classList.add("is-active"),e.target.disabled=!0,jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:a,plugin:t},success:function(r){if(HappyFiles.debug&&console.warn("import",a,t,r.data),r.success){if(e.target.remove(),r.data.hasOwnProperty("message")){var i=document.getElementById(t).querySelector(".message");i?(i.classList.add("success"),i.innerHTML=r.data.message):alert(r.data.message)}}else e.target.querySelector(".spinner").classList.remove("is-active"),e.target.removeAttribute("disabled"),r.data.hasOwnProperty("message")&&alert(r.data.message)}})}})),jQuery(document).on("click",".happyfiles-delete",(function(e){e.preventDefault();var t=e.target.getAttribute("data-plugin");if(t){e.target.querySelector(".spinner").classList.add("is-active"),e.target.disabled=!0;var a=-1!==["filebird","real-media-library"].indexOf(t)?"happyfiles_delete_third_pary_tables":"happyfiles_delete_third_party_terms";jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:a,plugin:t},success:function(r){HappyFiles.debug?console.warn("delete",a,t,r.data):r.success?location.reload():(e.target.querySelector(".spinner").classList.remove("is-active"),e.target.removeAttribute("disabled"))}})}})),jQuery(document).on("click","#happyfiles-import",(function(e){e.preventDefault();var t=document.createElement("input");t.type="file",t.onchange=function(e){var t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=function(e){jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:"happyfiles_import_folder_structure",folders:e.target.result},success:function(e){console.info(e.data),e.data.hasOwnProperty("message")&&alert(e.data.message)}})}},t.click()})),jQuery(document).on("click","#happyfiles-export",(function(e){e.preventDefault();var t=e.target.closest("td").querySelectorAll("input[type=checkbox]:checked");if(t.length){for(var a=[],r=0;r<t.length;r++)a.push(t[r].value);jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:"happyfiles_export_folders",postTypes:a},success:function(t){var a=t.data;a=(a=a.filter((function(e){return e.term_id>0}))).sort((function(e,t){return parseInt(e.level)-parseInt(t.level)}));var r="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a)),i=document.createElement("a"),s=new Date,l=s.getFullYear(),n=s.getMonth()+1,o=s.getDate();i.setAttribute("href",r),i.setAttribute("download","happyfiles-folders-"+l+"-"+n+"-"+o+".json"),e.target.parentNode.insertBefore(i,e.target.nextSibling),i.click(),setTimeout((function(){i.remove()}),100)}})}})),jQuery(document).on("click","#happyfiles-delete-plugin-data",(function(e){e.preventDefault(),confirm(HappyFiles.i18n.deletePluginData)&&jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:"happyfiles_delete_plugin_data"},success:function(e){e.data.hasOwnProperty("message")&&alert(e.data.message),HappyFiles.debug?console.warn(e):e.data.hasOwnProperty("optionsDeleted")&&e.data.optionsDeleted.length&&location.reload()}})})),jQuery(document).on("click","#happyfiles-deactivate-license",(function(e){e.preventDefault(),e.target.setAttribute("disabled","disabled"),jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:"happyfiles_deactivate_license"},success:function(t){e.target.removeAttribute("disabled"),t.data.hasOwnProperty("message")&&alert(t.data.message),t.success&&location.reload()}})})),jQuery(document).on("click","#happyfiles-regenerate-filesizes",(function(e){e.preventDefault();var t=e.target.dataset.attachmentIds;if(t){e.target.setAttribute("disabled","disabled"),t=t.split(",");var a=document.getElementById("happyfiles-regenerate-filesizes-results");t.forEach((function(r,i){jQuery.ajax({method:"POST",url:HappyFiles.ajaxUrl,data:{action:"happyfiles_regenerate_filesize",attachmentId:r},success:function(r){if(a){var s=a.innerHTML;t.length-1===i?(s='<li class="done">Done ('+t.length+")!</li>"+s,e.target.removeAttribute("disabled")):s="<li>"+r.data.id+": "+r.data.filesize+" ("+r.data.name+")</li>"+s,a.innerHTML=s}}})}))}}))}));